# 迭代运行手册 (Iteration Playbook)
版本：v1.1 | 更新：2026-02-26

> 本文件定义团队系统"如何随时间进化"的完整规则。
> 所有参与者（BOSS Agent、进化治理 Agent）都必须遵守此手册。

---

## 核心设计原则

```
自动分析 + 人工确认 = 可信进化

不允许：AI 自动修改团队定义文件
必须：生成提案 → 用户确认 → BOSS 落盘执行
```

这样做的原因：
- 团队规则是长期积累的，错误修改代价高
- 用户的确认本身就是一次学习机会
- 保持系统完全透明可审计

---

## 一、任务级复盘（每次任务后，自动执行）

### 触发时机
每次 BOSS Agent 完成一个任务，在 Phase 6（收口）阶段自动执行。

### 执行步骤

1. BOSS 提取本次任务的 1-3 个关键点：
   - 有哪些重要决策
   - 用户是否纠正了某个方向
   - 是否发现了新的用户偏好

2. 以简洁格式向用户展示：
   ```
   ✅ 任务完成：[任务名]

   📌 本次关键点（是否记录？）
   1. [决策或偏好描述] → 建议写入 [decisions-log / user-habits]
   2. [...]

   [确认记录] [不记录] [修改后记录]
   ```

3. 用户确认后，BOSS 按 `memory-policy.md` 写入对应文件。

### 不允许的行为
- 未经确认就写入记忆
- 把"这次特殊情况"写成永久规则
- 复盘超过 3 条（保持简洁，否则用户会跳过）

---

## 二、周回顾（每 7 天或用户触发）

### 触发方式
- 用户说："做个周回顾" / "weekly"
- BOSS 记录任务计数，满 7 天时主动提醒用户

### 执行流程

```
BOSS 启动 Evolution Team（进化治理 Agent）
     ↓
Evolution Team 读取：
  - memory/decisions-log.md（近 20 条）
  - memory/user-habits.md
  - team-standards/changelog.md（近期变更）
     ↓
生成周回顾报告（含升级提案）
     ↓
BOSS 向用户展示报告
     ↓
用户确认要执行的提案
     ↓
BOSS 执行文件修改 + 更新 changelog
```

### 周回顾关注点

| 检查项 | 来源 | 目标 |
|---|---|---|
| 完成任务数 | decisions-log 条目数 | 了解工作量 |
| 用户纠正次数 | decisions-log 中标注的"纠正" | 返工率分析 |
| 高频问题团队 | decisions-log 来源团队 | 找到需改进的团队 |
| 新增偏好 | user-habits 近期条目 | 确认学习效果 |
| 记忆健康 | 三个 memory 文件大小 | 防止过度膨胀 |

---

## 三、月度升级（每 30 天或用户触发）

### 触发方式
- 用户说："月度升级" / "做个月度"
- BOSS 每月主动提醒一次

### 执行流程

```
BOSS 启动 Evolution Team（月度升级模式）
     ↓
Evolution Team 全量分析：
  - 所有 decisions-log 条目
  - 所有 team-standards 文件版本
  - changelog 近期变更频率
     ↓
生成月度升级提案（可能涉及多个文件）
     ↓
用户审核提案（可逐项确认）
     ↓
BOSS 按确认项执行：
  - 修改团队定义文件（更新版本号）
  - 更新 CLAUDE.md 路由规则（如有）
  - 追加 changelog 记录
  - 归档旧 decisions-log 条目（如超过 40 条）
```

### 月度可能触发的重大变更

| 变更类型 | 触发条件 | 风险级别 |
|---|---|---|
| 团队定义微调 | 某团队高频出同类问题 | 低 |
| 路由规则调整 | 任务反复被分配给错误团队 | 中 |
| 新增团队 | 有类型任务完全没有对应团队 | 中 |
| 拆分现有团队 | 某团队职责边界不清，造成冲突 | 高 |
| 门禁标准变更 | 发现现有标准过松或过严 | 高 |

**高风险变更必须用户明确确认，不得捆绑执行。**

---

## 四、提案执行协议

### 提案格式（标准）

```markdown
### 提案 [编号]：[标题]

**类型：** 规则调整 / 流程优化 / 新增能力 / 记忆清理
**影响范围：** [哪个文件的哪个部分]
**风险等级：** 低 / 中 / 高

**变更前：**
[原内容或"不存在"]

**变更后：**
[新内容]

**变更原因：**
[来自哪些数据或用户反馈]

**可回滚：** 是（changelog 有记录）
```

### 执行后必须做的事

1. 更新被修改文件的版本号（在文件头部）
2. 在 `team-standards/changelog.md` 追加记录
3. 在 `memory/decisions-log.md` 追加一条：
   ```
   [日期] 团队升级：[提案标题]，版本 vX.X → vX.Y
   ```

---

## 五、记忆归档规则

### 何时归档 decisions-log

当 `decisions-log.md` 超过 **40 条** 时，进化团队建议归档：
- 将 30 天前的条目移至 `memory/archive/decisions-[年月].md`
- `decisions-log.md` 保留最近 20-30 条

### 何时清理 user-habits

当发现以下情况时，进化团队建议清理：
- 同一主题有多条矛盾记录（只保留最新确认的）
- 某条偏好在 30+ 天内从未被应用（可能已失效）
- 某条记录描述模糊无法指导行为

**清理前必须向用户展示将被删除/修改的内容，逐条确认。**

---

## 六、不允许自动做的事（硬性限制）

以下操作无论什么情况都**不得**在未经用户确认的情况下执行：

- ❌ 修改任何 `agents/teams/*.md` 文件
- ❌ 修改 `CLAUDE.md`
- ❌ 覆盖 `memory/user-habits.md` 中的现有条目
- ❌ 删除 `memory/decisions-log.md` 中的任何记录
- ❌ 修改 `team-standards/operating-protocol.md`
- ❌ 拆分或新增团队

---

## 七、触发词速查

| 用户说 | BOSS 的动作 |
|---|---|
| "周回顾" / "weekly" | 启动 Evolution Team → 周回顾模式 |
| "月度升级" / "monthly" | 启动 Evolution Team → 月度升级模式 |
| "诊断[团队名]" | 启动 Evolution Team → 单团队诊断模式 |
| "迭代一下" | 启动 Evolution Team → 按需优化模式 |
| "记住这个" | BOSS 直接处理 → 写入 user-habits（需确认） |
| "忘掉这个" | BOSS 直接处理 → 删除对应记忆（需确认） |
| "查看记忆" | BOSS 直接读取并展示三个 memory 文件摘要 |
| "团队状态" | BOSS 展示所有团队定义版本和最近 changelog |
